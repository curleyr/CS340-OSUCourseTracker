<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Courses</title>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      // //////// //
      // FUNCTION //
      // //////// //
      // Handle toggling page from viewing courses to adding a course and back
      document.getElementById("add_course_button").addEventListener("click", toggleCourseForm);
      document.getElementById("cancel_add_course_button").addEventListener("click", toggleCourseForm);
      function toggleCourseForm() {
        const view_courses_section = document.getElementById("view_courses_section");
        const add_course_section = document.getElementById("add_course_section");

        if (view_courses_section.style.display === "block") {
          view_courses_section.style.display = "none";
          add_course_section.style.display = "block";

        } else {
          view_courses_section.style.display = "block";
          add_course_section.style.display = "none";
        }
      };

      // //////// //
      // FUNCTION //
      // //////// //
      // Handle add new course form submission
      document.getElementById("add_course_form").onsubmit = addCourse;

      async function addCourse(event) {
        // Prevent page from refreshing
        event.preventDefault();

        // Instantiate FormData object
        const formData = new FormData(event.target);
        // Initialize data object. This will be built below
        const data = {};

        // Iterate through each key value pair from formData
        formData.forEach((value, key) => {
          // Course ID array needs to be constructed
          if (key === "prerequisite_course_ids") {
            // Create empty prerequisite_course_ids array if not already included in data object
            if (!data[key]) {
              data[key] = [];
            }
            // Push course ID to prerequisite_course_ids array
            data[key].push(value);

            // All non-course keys can be pushed directly as separate data object properties
          } else {
            data[key] = value;
          }
        });
        // Logging to console for debugging purposes
        console.log(data);
      };
    });

  </script>

</head>

<body>

  <header>
    <h1>Courses</h1>
  </header>

  <main>
    <p><a href="/index">Back to index</a></p>

    {# View All Course Section #}
    <section id="view_courses_section" style="display: block;">
      <h3>View All Courses & Prerequisites</h3>
      <button id="add_course_button" type="button">Add New Course</button>
      <table>
        <tr>
          {# <th>ID</th> #}
          <th>Course</th>
          <th>Credit</th>
          <th>Prerequisites</th>
        </tr>
        {% for course in courses %}
        <tr>
          {# <td>{{ course["id"] }}</td> #}
          <td>{{ course["course"] }}</td>
          <td>{{ course["credit"] }}</td>
          <td>{{ course["prerequisites"] }}</td>
        </tr>
        {% endfor %}
      </table>
    </section>

    {# Add New Course Section #}
    <section id="add_course_section" style="display: none;">
      <h3>Add New Course</h3>
      <form id="add_course_form">
        {# Course Code #}
        <label for="course_code">Code</label><br>
        <input type="text" id="course_code" name="course_code" aria-label="Code" required /><br>

        <label for="course_name">Name</label><br>
        <input type="text" id="course_name" name="course_name" aria-label="Name" required /><br>

        <label for="course_credit">Credit</label><br>
        <select name="course_credit" id="course_credit" aria-label="Credit" required>
          <option value="" disabled selected>Select credit</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select><br>

        {# Prerequisites #}
        <p>Prerequisites</p>
        {% for course in courses %}
        <label>
          <input type="checkbox" name="prerequisite_course_ids" value={{ course["id"] }}> {{ course["course"] }}
        </label><br>
        {% endfor %}

        {# Submit and Cancel Buttons #}
        <button id="submit_add_course_button" type="submit">Submit</button><br>
        <button id="cancel_add_course_button" type="button">Cancel</button>
      </form>
    </section>

  </main>

</body>

</html>